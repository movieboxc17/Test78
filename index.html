<!DOCTYPE html>
<html>
<head>
    <title>File Editor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        #fileInput {
            display: none;
        }
        #editor {
            width: 80%;
            height: 300px;
            margin: 20px auto;
            border: 1px solid #ccc;
            padding: 10px;
        }
        .highlight {
            background-color: yellow;
        }
    </style>
</head>
<body>
    <h1>File Editor</h1>
    
    <input type="file" id="fileInput" accept=".txt" />
    <button onclick="openFile()">Open File</button>
    <button onclick="saveFile()">Save File</button>
    
    <button onclick="uploadFile()">Upload File</button>
    <button onclick="clearEditor()">Clear Editor</button>
    <button onclick="countWords()">Count Words</button>
    <label for="fontSize">Font Size:</label>
    <select id="fontSize" onchange="changeFontSize()">
        <option value="12px">12px</option>
        <option value="16px">16px</option>
        <option value="20px">20px</option>
    </select>
    <label for="textColor">Text Color:</label>
    <input type="color" id="textColor" onchange="changeTextColor()">
    
    <label for="searchInput">Search:</label>
    <input type="text" id="searchInput">
    <button onclick="searchAndHighlight()">Search</button>
    
    <label for="alignment">Text Alignment:</label>
    <select id="alignment" onchange="changeTextAlignment()">
        <option value="left">Left</option>
        <option value="center">Center</option>
        <option value="right">Right</option>
    </select>
    
    <button onclick="downloadAsPDF()">Download as PDF</button>
    <button onclick="countCharacters()">Count Characters</button>
    
    <div id="editor" contenteditable="true"></div>

    <a id="downloadLink" style="display: none;">Download File</a>
    
    <div id="wordCount"></div>
    <div id="charCount"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script>
        let currentFile = null;
        const editor = document.getElementById("editor");
        const undoStack = [];
        const redoStack = [];

        function openFile() {
            const fileInput = document.getElementById("fileInput");
            fileInput.click();

            fileInput.addEventListener("change", function (e) {
                const file = e.target.files[0];
                currentFile = file;

                const reader = new FileReader();
                reader.onload = function (event) {
                    const contents = event.target.result;
                    editor.textContent = contents;
                    
                    // Track the initial state for undo/redo
                    undoStack.push(contents);
                };
                reader.readAsText(file);
            });
        }

        function saveFile() {
            if (!currentFile) {
                alert("No file selected.");
                return;
            }

            const editorContent = editor.textContent;
            const blob = new Blob([editorContent], { type: "text/plain" });
            const url = URL.createObjectURL(blob);

            const downloadLink = document.getElementById("downloadLink");
            downloadLink.href = url;
            downloadLink.download = currentFile.name;
            downloadLink.style.display = "block";
        }

        function uploadFile() {
            const fileUpload = document.getElementById("fileInput");
            fileUpload.click();

            fileUpload.addEventListener("change", function (e) {
                const file = e.target.files[0];

                // You can add code here to upload the file to the server using AJAX or fetch.
            });
        }

        function clearEditor() {
            editor.textContent = "";
        }

        function countWords() {
            const editorContent = editor.textContent;
            const words = editorContent.split(/\s+/).filter(word => word.trim() !== "");
            document.getElementById("wordCount").textContent = `Word Count: ${words.length}`;
        }

        function changeFontSize() {
            const fontSize = document.getElementById("fontSize").value;
            editor.style.fontSize = fontSize;
        }

        function changeTextColor() {
            const textColor = document.getElementById("textColor").value;
            editor.style.color = textColor;
        }

        function searchAndHighlight() {
            const searchText = document.getElementById("searchInput").value;
            const regex = new RegExp(searchText, "gi");
            const highlightedText = editor.textContent.replace(regex, (match) => `<span class="highlight">${match}</span>`);
            editor.innerHTML = highlightedText;
        }

        function changeTextAlignment() {
            const alignment = document.getElementById("alignment").value;
            editor.style.textAlign = alignment;
        }

        function downloadAsPDF() {
            const editorContent = editor.textContent;
            const pdf = new jsPDF();
            pdf.text(editorContent, 10, 10);
            pdf.save("document.pdf");
        }

        function countCharacters() {
            const editorContent = editor.textContent;
            const charCount = editorContent.length;
            document.getElementById("charCount").textContent = `Character Count: ${charCount}`;
        }

        function undo() {
            if (undoStack.length > 0) {
                const previousState = undoStack.pop();
                redoStack.push(editor.textContent);
                editor.textContent = previousState;
            }
        }

        function redo() {
            if (redoStack.length > 0) {
                const nextState = redoStack.pop();
                undoStack.push(editor.textContent);
                editor.textContent = nextState;
            }
        }
    </script>
</body>
</html>
